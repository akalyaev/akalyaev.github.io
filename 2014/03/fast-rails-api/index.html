<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Fast Rails API"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@akaliaev"/>



  	<meta property="og:title" content="Fast Rails API &middot; Home on Rails" />
  	<meta property="og:site_name" content="Home on Rails" />
  	<meta property="og:url" content="http://homeonrails.com/2014/03/fast-rails-api/" />

    
        
            <meta property="og:image" content="/images/cover.png"/>
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2014-03-09T13:00:00Z" />

    
    <meta property="article:tag" content="talks" />
    
    <meta property="article:tag" content="ruby-on-rails" />
    
    <meta property="article:tag" content="api" />
    
    

    <title>Fast Rails API &middot; Home on Rails</title>

    
    <meta name="description" content="&lt;p&gt;Here are the slides from my internal talk, which I recently gave for my
colleagues.&lt;/p&gt;

&lt;p&gt;They are showing the history of optimizing Rails API, starting fr" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://homeonrails.com/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://homeonrails.com/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="http://homeonrails.com/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://homeonrails.com/css/nav.css" />

    

    
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/solarized-dark.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
        
        <script>hljs.initHighlightingOnLoad();</script>
    

    
      
          <link href="http://homeonrails.com/index.xml" rel="alternate" type="application/rss+xml" title="Home on Rails" />
      
      
    
    <meta name="generator" content="Hugo 0.55.6" />

    <link rel="canonical" href="http://homeonrails.com/2014/03/fast-rails-api/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name":  null ,
        "logo": "http://homeonrails.com/images/logo.png"
    },
    "author": {
        "@type": "Person",
        "name":  null ,
        
        "image": {
            "@type": "ImageObject",
            "url": "http://homeonrails.com/images/logo.png",
            "width": 250,
            "height": 250
        }, 
        
        "url": "http://homeonrails.com",
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": "Fast Rails API",
    "name": "Fast Rails API",
    "wordCount":  213 ,
    "timeRequired": "PT1M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "http://homeonrails.com/2014/03/fast-rails-api/",
    "datePublished": "2014-03-09T13:00Z",
    "dateModified": "2014-03-09T13:00Z",
    
    "keywords": "talks, ruby-on-rails, api",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://homeonrails.com/2014/03/fast-rails-api/"
    }
}
    </script>
    


    

    

    
        
    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://homeonrails.com/">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://homeonrails.com/about">About me</a>
            </li>
        
            <h3>Explore</h3>
            <li class="nav-opened" role="presentation">
            	<a href="http://homeonrails.com/most-popular-posts">Most popular posts</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://speakerdeck.com/melekes">Talks</a>
            </li>
        
            <h3>Follow Me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/melekes">Github repos</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/akaliaev">Twitter timeline</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://www.goodreads.com/melekes">Goodreads books</a>
            </li>
        
            <h3>Contact Me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="http://www.linkedin.com/in/melekes">LinkedIn</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://Keybase.io/melekes">Keybase (secure msg)</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://homeonrails.com/pgp/">PGP Pub Key</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="http://homeonrails.com/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="http://homeonrails.com/"><img src="http://homeonrails.com/images/logo.png" alt="Home" /></a>
  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Fast Rails API</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2014-03-09T13:00:00Z">
            Mar 9, 2014
          </time>
        
         
          <span class="post-tag small"><a href="http://homeonrails.com//tags/talks/">#talks</a></span>
         
          <span class="post-tag small"><a href="http://homeonrails.com//tags/ruby-on-rails/">#ruby-on-rails</a></span>
         
          <span class="post-tag small"><a href="http://homeonrails.com//tags/api/">#api</a></span>
         
        </section>
    </header>

    <section class="post-content">
      <p>Here are the slides from my internal talk, which I recently gave for my
colleagues.</p>

<p>They are showing the history of optimizing Rails API, starting from AR connections pool and
ending by using Fragment caching. Also there is list of tools for
profiling applications (stackprof, etc.). All techniques are quite
famous.</p>

<script async="true" class="speakerdeck-embed" data-id="b618391085100131b8c566a463623da4" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js">       </script>

<p>&nbsp;</p>

<h2 id="what-we-ve-tried">What we&rsquo;ve tried</h2>

<ol>
<li>Connection pool

<ul>
<li><a href="https://devcenter.heroku.com/articles/concurrency-and-database-connections">Concurrency and Database Connections in Ruby with ActiveRecord</a></li>
</ul></li>
<li><a href="https://github.com/rails-api/rails-api">Rails-api</a></li>
<li>Do not load <code>rails/all</code></li>
<li>Establish DB connection after fork/new thread was created</li>
<li><a href="https://github.com/kzk/unicorn-worker-killer">Unicorn worker killer</a></li>
<li>Postgresql tuning

<ul>
<li><a href="http://postgresql.leopard.in.ua/html/">Работа с PostgreSQL: настройка и масштабирование Алексея Васильева</a></li>
<li><a href="http://momjian.us/main/writings/pgsql/hw_performance/">PostgreSQL Hardware Performance Tuning by Bruce Momjian</a></li>
<li><a href="http://raghavt.blogspot.ru/2012/04/caching-in-postgresql.html">Caching in PostgreSQL</a></li>
</ul></li>
<li>Rails 4</li>
<li>Ruby 2.1.0</li>
<li>Fragment caching

<ul>
<li><a href="https://devcenter.heroku.com/articles/caching-strategies">Caching Strategies for Rails</a></li>
<li><a href="http://signalvnoise.com/posts/3113-how-key-based-cache-expiration-works">How key-based cache expiration works</a></li>
</ul></li>
<li><a href="https://github.com/rails-api/active_model_serializers">Active Model Serializers</a></li>
<li><a href="https://github.com/ohler55/oj">Oj</a></li>
<li>Do not instantiate AR objects

<ul>
<li><a href="http://brainspec.com/blog/2012/09/28/lightning-json-in-rails/">Lightning JSON in Rails</a></li>
</ul></li>
<li>Try <a href="https://github.com/tmm1/gctools">OOBGC - Out-of-Band GC</a></li>
<li>Try different web server (e.g. Puma)</li>
</ol>

<p>If we missed something, please share your ideas in comments.</p>

<h2 id="profiling-tools">Profiling tools</h2>

<ol>
<li><a href="https://github.com/tmm1/stackprof">Stackprof</a></li>
<li><a href="https://github.com/miniprofiler/rack-mini-profiler">Rack Mini Profiler</a></li>
<li><a href="https://github.com/flyerhzm/bullet">Bullet</a></li>
<li><a href="https://github.com/wvanbergen/request-log-analyzer">Request log analyzer</a></li>
<li><a href="http://newrelic.com/">NewRelic</a></li>
</ol>

<p>On the penultimate slide is the title slide of the <a href="http://www.slideshare.net/maxlapshin/rails-26416461">presentation</a> of Max
Lapshin, which briefly tells that to solve certain problems (such as when you need to
keep a large number of clients) more appropriate solution might be using
another technologies/languages (Erlang in particular).</p>

<p>UPD. Ideas from comments</p>

<ol>
<li>Try <a href="http://api.rubyonrails.org/classes/ActionController/ConditionalGet.html">Conditional Get</a></li>
</ol>
    </section>


  <footer class="post-footer">


    








<figure class="author-image">
    <a class="img" href="http://homeonrails.com/" style="background-image: url(/images/logo.png)"><span class="hidden">Anton Kaliaev's Picture</span></a>
</figure>


<section class="author">
  <h4><a href="http://homeonrails.com/">Anton Kaliaev</a></h4>
  
  <p>Read <a href="http://homeonrails.com/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    
    <span class="author-link icon-link"><a href="http://homeonrails.com">http://homeonrails.com</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Fast%20Rails%20API&nbsp;-&nbsp;Home%20on%20Rails&amp;url=http%3a%2f%2fhomeonrails.com%2f2014%2f03%2ffast-rails-api%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fhomeonrails.com%2f2014%2f03%2ffast-rails-api%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2fhomeonrails.com%2f2014%2f03%2ffast-rails-api%2f&amp;description=Fast%20Rails%20API"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2fhomeonrails.com%2f2014%2f03%2ffast-rails-api%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "http:\/\/homeonrails.com\/2014\/03\/fast-rails-api\/";  
this.page.identifier = "http:\/\/homeonrails.com\/2014\/03\/fast-rails-api\/"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://homeonrails.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>








  </footer>
</article>

</main>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="http://homeonrails.com/2014/03/february-picks/">
          <section class="post">
              <h2>February picks</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="http://homeonrails.com/2014/02/january-picks/">
          <section class="post">
              <h2>January picks</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Home on Rails</a> All rights reserved</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://homeonrails.com/js/jquery.js"></script>
    <script type="text/javascript" src="http://homeonrails.com/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://homeonrails.com/js/index.js"></script>
    
</body>
</html>

